<!doctype html>
<html>
    <head lang="en">
        <title>Sierpinsky Triangle</title>
        <meta name="description" content="A Sierpinsky Triangle generator">
        <meta name="author" content="Avritt Rohwer">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta charset="utf-8">
        <style>
            body {
                font-family: sans-serif;
                max-width: 900px;
                margin: 0 auto;
                padding: 10px;
            }

            canvas {
                width: 100%;
            }
        </style>
    </head>

    <body>
        <h1>Welcome to the Sierpinsky Triangle generator!</h1>
        <p>I've always been interested in chaos theory and decided to make this visualizer because I was bored one afternoon.</p>
        <p>This animation is generated by playing the <a href="https://en.wikipedia.org/wiki/Chaos_game">chaos game</a>.</p>
        <button type="button" id="go">Go</button>
        <button type="button" id="stop">Stop</button>
        <button type="reset" id="reset">Reset</button>
        Really Fast?
            <input type="checkbox" id="fastEh">
        <br>
        <br>
        <canvas></canvas>
    </body>

    <script>
    // generates points that, when plotted, will draw a sierpinski triangle.
    // domain: [0, 1]
    // range: [0, Math.sqrt(3) / 2]
    function* givePoint() {
        const rootThreeOver2 = Math.sqrt(3) / 2

        // vertices of the triangle
        const a = {x: 0,   y: rootThreeOver2}
        const b = {x: 1,   y: rootThreeOver2}
        const c = {x: 0.5, y: 0}

        let point = {x: Math.random(), y: Math.random() * rootThreeOver2}
        yield point

        const vertices = [a, b, c]
        while (true) {
            // pick a vertex at random, go halfway towards it
            let vertex = vertices[Math.floor(Math.random() * 3)]
            point.x = (point.x + vertex.x) / 2
            point.y = (point.y + vertex.y) / 2
            
            yield point
        }
    }

    // set up canvas
    const canvas = document.querySelector('canvas')
    canvas.width = canvas.height
    const ctx = canvas.getContext('2d')

    // set up helpful constants
    let genPoints = givePoint()
    let animating = false
    let animationRequests = []
    let goFastEh = false

    function draw() {
        // get point and scale it to canvas size
        point = genPoints.next().value
        let x = Math.floor(point.x * canvas.width)
        let y = Math.floor(point.y * canvas.height)

        ctx.fillRect(x, y, 1, 1)
        animationRequests.push(requestAnimationFrame(draw))
    }

    // clears all animationFrameRequests
    function clearAnimationFrames() {
        for (let anim of animationRequests) {
            cancelAnimationFrame(anim)
        }
    }

    // register buttons
    document.querySelector('#go').addEventListener('click', () => {
        if (animating)
            return

        if (goFastEh) {
            for (let i = 0; i < 20; i++) { // spawn 20 draw functions that keep calling themselves
                animationRequests.push(requestAnimationFrame(draw))
            }
        } else {
            animationRequests.push(requestAnimationFrame(draw))
        }
        animating = true
    })
    document.querySelector('#stop').addEventListener('click', () => {
        animating = false
        clearAnimationFrames()
    })
    document.querySelector('#reset').addEventListener('click', () => {
        animating = false
        clearAnimationFrames()

        // reset globals
        genPoints = givePoint()
        ctx.clearRect(0, 0, canvas.width, canvas.height)
    })
    document.querySelector('#fastEh').addEventListener('change', (event) => {
        if (event.target.checked)
            goFastEh = true
        else
            goFastEh = false
    })
    </script>
</html>
